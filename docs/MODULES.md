# Module and Package Documentation

This document describes why each major module exists, what it owns versus what it delegates, and what it intentionally does not handle.

---

## `bellesoft_extra_part_details` (Python package)

**Why it exists:** Provides the InvenTree plugin entry point and all server-side logic for part totals and stock/location data.

**Core responsibility:**

- Register as an InvenTree plugin (entry point in `pyproject.toml`).
- Compute part-level purchase cost totals (with internal-price fallback), stock by status, and stock by location.
- Declare UI panels and dashboard items and supply the context each view needs.

**Owns:**

- Plugin metadata (TITLE, NAME, SLUG, VERSION, etc.).
- The three data methods: `part_total_purchase_cost`, `part_total_stock`, `part_stock_by_location`.
- The shape and contents of the context dict passed to the Part panel and dashboard.
- Which static entry points are used (e.g. `Panel.js:renderPartTotalPricePanel`).

**Delegates:**

- ORM and business rules to Django/InvenTree models (`Part`, `StockItem`, `StockLocation`, `StockStatus`).
- Plugin lifecycle and UI mixin behavior to InvenTree (`SettingsMixin`, `UserInterfaceMixin`).
- Money/currency handling to `djmoney`.

**Does not handle:**

- REST API endpoints (this plugin does not add any).
- Authentication/authorization beyond what InvenTree provides for plugin UI (e.g. dashboard restricted to staff).
- Frontend build or bundling; it only references built files in `static/`.

**How others interact:** InvenTree loads the plugin via the `inventree_plugins` entry point and calls `get_ui_panels()` / `get_ui_dashboard_items()` with request and context. The frontend is loaded by InvenTree from plugin static URLs and invoked with the context supplied by these methods.

---

## `bellesoft_extra_part_details.core`

**Why it exists:** Holds the single plugin class that implements all plugin behavior.

**Core responsibility:** Implement `BellesoftExtraPartDetails`: data methods and UI registration.

**Owns:** The implementation of `part_total_purchase_cost`, `part_total_stock`, `part_stock_by_location`, `get_ui_panels`, and `get_ui_dashboard_items`.

**Delegates:** As above (Django models, InvenTree mixins, djmoney). Does not define new models or URLs.

**Does not handle:** Version number (lives in `__init__.py` as `PLUGIN_VERSION`), packaging, or static file layout.

**How others interact:** Only InvenTree calls this class. The frontend does not import Python; it receives context from the host.

---

## `bellesoft_extra_part_details/static/`

**Why it exists:** InvenTree serves plugin UI by loading JS from the plugin’s static directory. This directory is the output of the frontend build.

**Core responsibility:** Hold built JS (and assets) and the Vite manifest so the host can resolve entry points (e.g. `Panel.js` → `renderPartTotalPricePanel`).

**Owns:** Built files only. Contents are generated by `frontend/` build; do not edit by hand.

**Delegates:** Source of truth for UI code to `frontend/src/`; build to Vite in `frontend/`.

**Does not handle:** Development server (that runs from `frontend/`); versioning or plugin metadata.

**How others interact:** InvenTree’s plugin UI loader requests these files. The Python plugin uses `plugin_static_file()` to refer to them by name (e.g. `Panel.js:renderPartTotalPricePanel`).

---

## `frontend/` (React/TypeScript app)

**Why it exists:** InvenTree plugins can ship custom UI that runs in the same React/Mantine environment as the host. This directory is the source for that UI and builds into the plugin’s `static/` directory.

**Core responsibility:**

- Implement the Part panel, dashboard item, and settings page components.
- Export the exact entry points the plugin expects (`renderPartTotalPricePanel`, `renderPartTotalPriceDashboardItem`, `renderPluginSettings`).
- Build to plugin `static/` with externals so React/Mantine are provided by InvenTree at runtime.

**Owns:**

- All React components and their presentation logic.
- Vite config (entry points, externals, output dir, manifest).
- Dev config for local preview (port, CORS).

**Delegates:**

- Data and business rules to the plugin backend (context only; no direct API calls for part totals).
- Version checking to `@inventreedb/ui` (`checkPluginVersion`).
- Styling and components to Mantine (external).

**Does not handle:**

- InvenTree REST API calls for this feature (data comes only via context).
- Plugin registration or backend logic.
- Translation loading at runtime: `locale.tsx` references `./locales/${locale}/messages.ts`, but no `locales/` directory exists in the repo today—so any use of that helper would fail until locales are added.

**How others interact:** The plugin core references built entry points by string (e.g. `Panel.js:renderPartTotalPricePanel`). InvenTree loads the script and calls the exported function with the context dict produced by `get_ui_panels()` / `get_ui_dashboard_items()`.

---

## `frontend/src/Panel.tsx`

**Why it exists:** Renders the Part Total Price panel on the Part detail page.

**Core responsibility:** Consume the panel context (totals, currency, mixed flag, locations_data) and render tables and alerts. No fetching.

**Owns:** Layout, sorting of locations (e.g. “No Location” last), and formatting of numbers/currency.

**Delegates:** Version check to `checkPluginVersion(context)`; component primitives to Mantine.

**Does not handle:** Computing totals or resolving locations; that is done in the backend. Does not handle settings or dashboard content.

---

## `frontend/src/Dashboard.tsx`

**Why it exists:** Provides the dashboard widget registered by `get_ui_dashboard_items()`.

**Core responsibility:** Export `renderPartTotalPriceDashboardItem` and render a staff-only dashboard block. Current content is placeholder (plugin name, username, counter).

**Owns:** Only the dashboard widget’s React tree. No part-total or stock data in the current implementation.

**Does not handle:** Part-level data or panel logic; the backend does not pass part totals into dashboard context today.

---

## `frontend/src/Settings.tsx`

**Why it exists:** Renders the plugin’s custom settings block in the InvenTree plugin settings UI (`ADMIN_SOURCE` / `renderPluginSettings`).

**Core responsibility:** Export `renderPluginSettings` and show the settings UI. Current content is placeholder (alert + button).

**Owns:** Only the settings block UI. No persistence logic (plugin `SETTINGS` is empty).

**Does not handle:** Panel, dashboard, or data logic; no backend settings are wired yet.
